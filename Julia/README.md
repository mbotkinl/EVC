# README for Julia EVC

Masters project for electric vehicle charging


## General File/Folder Structure

- Scripts are labeled by the problem (EVC or Hub) and formulation method (central, ADMM, ALAD, etc)
- Wrapper scripts are in the Julia directory
- Wrappers call functions from the files in the Julia/functions directory
- Other scripts used to create supplimental analysis plots are in "Analysis Scripts" directory

### Main Function Structure

The main functions that run the EVC PWL problem are in Julia/functions/funEVCpwl.jl 

Example description of ALADIN functions: 

- `EVCdecentral_ALADIN.jl` wrapper script calls `pwlEValad` wrapper function
- `pwlEValad` loops over MPC timesteps and calls `runEVALADStep` function
- `runEVALADStep` loops over iterations and calls `runEVALADIt` function
- `runEVALADIt` is the wrapper for one iteration of the ALADIN algorithm and calls `localEVALAD`, `localXFRMALAD`, and `coordALAD` functions

## Running Code

### Prerequisites

Main Julia Packages needed
```
JuMP
Gurobi
```

### Initialization 

Run `EVC_init.jl` to load packages, set parameters, and load or create scenario. Setting `datafile="n"` will create new scenario and `datafile="jld2"` will read saved scenario file from `path` and `file`. 

### Create/Read Central Solution

Run `EVCcentral.jl` will read or run central solution depending on `loadResults` parameter. 

### Create/Read Decentralized Solution

Similarly running scripts `EVCdecentral.jl`, `EVCdecentral_ADMM.jl`, or `EVCdecentral_ALADIN.jl` will run dual decomposition, ADMM, and ALADIN distributed methods, respectively. 


## Plotting
Plots use the `Plots` and `PyPlot` packages. Main plots exist at the end of each EVC or Hub wrapper script in the main Julia directory. Other visualization can be created using the scripts in the "Analysis Scripts" or `funEVCvis.jl` but are not fully built out and are still in development.


## Scenario
New scenarios are generated by running `setupScenario` with a few inputs. The scenario function has stochastic elements and the random seed is not fixes so rerunning the scenario setup multiple times will result in multiple unique scenarios. The scenario is saved into a custom `scenarioStruct` struct which is saved to a `JLD2` file based on the `saveS` parameter. 

### Scenario Variables
| Variable      | Description   |
| ------------- | ------------- |
| `N `        | Number of EVs  |
| `K` | Number of timesteps in entire simulation |
| `K1` | Single time step forecast horzion |
| `K2` | Additional time instants past control horizon |
| `Ts` | Length of time step (seconds) |
| `S` | Number of PWL segments  |
| `deltaI` | Width of PWL segment |
| `ItotalMax` | Current maximum of transformer (low side)  |
| `Tmax` | Temperature maximum of transformer |
| `t0` | Initial temperature of transformer |
| `gamma` | Transformer dynamics parameter |
| `tau` | Transformer dynamics parameter |
| `rho` | Transformer dynamics parameter |
| `iD_actual` | Actual background current at EV voltage level |
| `iD_pred` | Forecasted background current at EV voltage level |
| `Tamb_raw` | Ambient temperature (for reference, do not use in equation)|
| `Tamb` | Adjusted  Ambient temperature (includes offset for matching transformer dynamics)|
| `a` | Charging efficiency of each vehicle (for reference) |
| `b_kwh` | Battery size of each vehicle (for reference) |
| `imin` | Minimum charging current for each vehicle |
| `imax` | Maximum charging current for each vehicle |
| `s0` | Initial SoC of each vehicle |
| `Snmin` | Desired minimum SoC |
| `Kn` | Desired time step |
| `eta` | EV dynamics parameter |
| `Qsi` | Objective weights (row is vehicle + transformer, column is timestep)|
| `Ri` | Objective weights  (row is vehicle, column is timestep)|
| `beta` | weight for slack (not fully implemented) |

